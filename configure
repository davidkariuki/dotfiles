#!/usr/bin/env zsh

set -e

echo "Enabling & disabling services..."
sudo systemctl enable nordvpnd.service --now
sudo systemctl enable bluetooth.service --now
sudo systemctl disable lightdm.service
sudo systemctl enable sddm.service
sudo systemctl enable betterlockscreen@$USER --now
sudo usermod -aG nordvpn $USER
sudo usermod -aG video $USER

echo "Starting Desktop Configuration..."
sleep 2

if ! [[ $SHELL == *"zsh"* ]]; then
	chsh -s $(which zsh)
fi

echo "Setting up ZSH plugins..."
sleep 2
if [ ! -d ~/.oh-my-zsh ]; then
	sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi
if [ ! -d ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions ]; then
	git clone https://github.com/zsh-users/zsh-autosuggestions.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
fi

if [ ! -d ~/.oh-my-zsh/custom/plugins/F-Sy-H ]; then
	git clone https://github.com/z-shell/F-Sy-H.git \
		${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/F-Sy-H
fi

if [ ! -d ~/.oh-my-zsh/custom/plugins/zsh-vi-mode ]; then
  git clone https://github.com/jeffreytse/zsh-vi-mode \
  ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/zsh-vi-mode
fi
clear

echo "Configuring bun..."
sleep 2
if [ ! -d ~/.bun/bin/bun ]; then
  curl -fsSL https://bun.sh/install | bash
	source ~/.zshrc
fi
clear

echo "Adding linters & formatters..."
sleep 2
bun i -g typescript prettier n vscode-langservers-extracted
clear

echo "Installing tmux plugins..."
sleep 2
if [ ! -d ~/.tmux/plugins/tpm ]; then
	mkdir -p ~/.tmux/plugins
	git clone https://github.com/tmux-plugins/tpm.git ~/.tmux/plugins/tpm
fi
clear

echo "Configuring devices..."
sudo cp .config/devices/30-touchpad.conf /etc/X11/xorg.conf.d/
sudo cp .config/devices/00-keyboard.conf /etc/X11/xorg.conf.d/
sudo cp .config/devices/backlight.rules /etc/udev/rules.d/
sudo cp -R .config/sddm/sugar-candy /usr/share/sddm/themes/
sudo cp .config/wallpaper/wall.jpg /usr/share/sddm/themes/sugar-candy/Backgrounds/
sudo cp .config/sddm/sddm.conf /etc/

sleep 2
echo "Installation complete."
