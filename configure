#!/usr/bin/env zsh

set -e

echo "Enabling services..."
sudo systemctl enable nordvpnd.service --now
sudo systemctl enable bluetooth.service --now
sudo systemctl enable betterlockscreen@$USER --now
sudo usermod -aG nordvpn $USER

echo "Starting Desktop Configuration..."
sleep 2

if ! [[ $SHELL == *"zsh"* ]]; then
	chsh -s $(which zsh)
fi

echo "Setting up ZSH plugins..."
sleep 2
if [ ! -d ~/.oh-my-zsh ]; then
	sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi
if [ ! -d ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions ]; then
	git clone https://github.com/zsh-users/zsh-autosuggestions.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
fi

if [ ! -d ~/.oh-my-zsh/custom/plugins/F-Sy-H ]; then
	git clone https://github.com/z-shell/F-Sy-H.git \
		${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/plugins/F-Sy-H
fi
clear

echo "Configuring pnpm..."
sleep 2
if [ ! -d ~/.local/share/pnpm ]; then
	curl -fsSL https://get.pnpm.io/install.sh | sh -
	source ~/.zshrc
fi
clear

echo "Adding linters & formatters..."
sleep 2
pnpm i -g typescript prettier n vscode-langservers-extracted
clear

echo "Installing tmux plugins..."
sleep 2
if [ ! -d ~/.tmux/plugins/tpm ]; then
	mkdir -p ~/.tmux/plugins
	git clone https://github.com/tmux-plugins/tpm.git ~/.tmux/plugins/tpm
fi
clear

echo "Configuring devices..."
sudo cp 30-touchpad.conf /etc/x11/xorg.conf.d/

sleep 2
echo "Installation complete."
